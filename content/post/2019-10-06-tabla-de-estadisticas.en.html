---
title: Tabla resumen de estadísticas de una muestra (en HTML y Latex con KableExtra) 
author: Patricio Said
date: '2019-10-06'
slug: tabla-resumen-estadisticas
categories: ["blog"]
tags: ["dplyr","tidyr","kableExtra", "HTML", "Latex","tabla","summarise"]
#image: "img/martini.jpg"
description: ""
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<p>En cualquier trabajo de investigación que involucre una muestra o conjunto de datos es importante mostrar un cuadro resumen que contenga estadísticas descriptivas del conjunto, de esta manera se puede comunicar de forma clara la dimensión de los datos del estudio.</p>
<p>Con solo dos herramientas la construcción de tablas resúmnes resulta muy facil y sencilla. Las funciones de <code>dplyr</code> permiten calcular diferentes estadísticas según grupos. Una vez terminada la tabla el paquete <code>kableExtra</code> transforma facimente la información de la tabla a formato HTML o Latex (para visualizar en PDF).</p>
<div id="los-datos-a-usar" class="section level2">
<h2>Los datos a usar</h2>
<p>Para este ejemplo utilizo los datos <code>vuelos</code> que están dentro del paquete <code>datos</code>. <code>vuelos</code> es la traducción al español del conjunto <code>nycflights13::flights</code>. Este conjunto contiene los datos de los vuelos que despegaron de Nueva York durante el 2013.</p>
<pre class="r"><code>library(datos)
library(tidyverse)
vuelos</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     anio   mes   dia horario_salida salida_programa~ atraso_salida
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;          &lt;int&gt;            &lt;int&gt;         &lt;dbl&gt;
##  1  2013     1     1            517              515             2
##  2  2013     1     1            533              529             4
##  3  2013     1     1            542              540             2
##  4  2013     1     1            544              545            -1
##  5  2013     1     1            554              600            -6
##  6  2013     1     1            554              558            -4
##  7  2013     1     1            555              600            -5
##  8  2013     1     1            557              600            -3
##  9  2013     1     1            557              600            -3
## 10  2013     1     1            558              600            -2
## # ... with 336,766 more rows, and 13 more variables:
## #   horario_llegada &lt;int&gt;, llegada_programada &lt;int&gt;, atraso_llegada &lt;dbl&gt;,
## #   aerolinea &lt;chr&gt;, vuelo &lt;int&gt;, codigo_cola &lt;chr&gt;, origen &lt;chr&gt;,
## #   destino &lt;chr&gt;, tiempo_vuelo &lt;dbl&gt;, distancia &lt;dbl&gt;, hora &lt;dbl&gt;,
## #   minuto &lt;dbl&gt;, fecha_hora &lt;dttm&gt;</code></pre>
<p>Los datos vienen en formato tibble. De manera de ejemplo y poder probar las agrupaciones de columnas y filas al momento de mostrar la tabla voy a filtrar el conjunto de datos en un rango de tres meses (septiembre a noviembre) y trabajar con los datos de las 3 aerolíneas con más vuelos.</p>
</div>
<div id="preparando-los-datos" class="section level1">
<h1>Preparando los datos:</h1>
<p><code>mayores_aerolineas</code> guarda las 3 aerolineas con mas vuelos:</p>
<pre class="r"><code>mayores_aerolineas &lt;- vuelos %&gt;% select(mes, aerolinea) %&gt;% 
  filter(mes %in% (9:11)) %&gt;% 
  group_by( aerolinea) %&gt;% 
    summarise(n = n()) %&gt;% 
  arrange(desc(n)) %&gt;% 
  slice(1:3) %&gt;% 
  ungroup()

# Busca los nombres  
aerolineas %&gt;% 
  filter(aerolinea %in% mayores_aerolineas$aerolinea)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   aerolinea nombre                  
##   &lt;chr&gt;     &lt;chr&gt;                   
## 1 B6        JetBlue Airways         
## 2 EV        ExpressJet Airlines Inc.
## 3 UA        United Air Lines Inc.</code></pre>
<p>En <code>datos</code> guarda los datos a utilizar para este ejemplo.</p>
<pre class="r"><code>datos &lt;- vuelos %&gt;% 
  select(mes, aerolinea, atraso_llegada, atraso_salida) %&gt;% 
  filter(atraso_salida &gt; 0 , atraso_llegada &gt; 0) %&gt;% 
  filter(mes &gt;=9, mes &lt;=11) %&gt;% 
  filter(aerolinea %in% mayores_aerolineas$aerolinea) %&gt;% 
  arrange(mes)
datos</code></pre>
<pre><code>## # A tibble: 8,688 x 4
##      mes aerolinea atraso_llegada atraso_salida
##    &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1     9 B6                     3            10
##  2     9 B6                   139           152
##  3     9 EV                     8            11
##  4     9 B6                     9             2
##  5     9 B6                    13            18
##  6     9 B6                    46            57
##  7     9 EV                    61            80
##  8     9 EV                     4            25
##  9     9 UA                    16            50
## 10     9 EV                    30            38
## # ... with 8,678 more rows</code></pre>
<p>De manera de hacer un ejemplo práctico, generalmente en los papers que ajustan modelos de predicción suele mostrarse el conjunto de datos separados en “ajuste” y “prueba”. Para esto, el conjunto <code>datos</code> se dividió aleatoriamente en proporción 80:20. Luego para cada conjunto se calcularon algunas estadísticas en base a la variable <code>atraso_llegada</code>.</p>
<pre class="r"><code>datos &lt;- datos %&gt;%  
  mutate(conjunto = sample(c(&quot;train&quot;,&quot;test&quot;), nrow(datos), replace = T, prob = c(0.8,0.2)))

datos_train &lt;- datos %&gt;% select(mes,aerolinea, conjunto, atraso_llegada) %&gt;% 
  filter(conjunto == &quot;train&quot;) %&gt;% 
  group_by(mes, aerolinea) %&gt;% 
  summarise(n_train = n(), 
            min_llegada_train = min(atraso_llegada),
            prom_llegada_train = mean(atraso_llegada),
            max_llegada_train = max(atraso_llegada),
            sd_llegada_train = sd(atraso_llegada)
            ) %&gt;% 
  ungroup()

datos_test &lt;- datos %&gt;% select(mes,aerolinea, conjunto, atraso_llegada) %&gt;% 
  filter(conjunto == &quot;test&quot;) %&gt;% 
  group_by(mes, aerolinea) %&gt;% 
  summarise(n_test = n(), 
            min_llegada_test = min(atraso_llegada),
            prom_llegada_test = mean(atraso_llegada),
            max_llegada_test = max(atraso_llegada),
            sd_llegada_test = sd(atraso_llegada)
            ) %&gt;% 
  ungroup()</code></pre>
<p>Luego en <code>resumen</code> se guardó la información a mostrar en la tabla.</p>
<pre class="r"><code>resumen &lt;- left_join(datos_train,datos_test) %&gt;% 
  mutate(mes = case_when(
                      mes == 9 ~ &quot;Septiembre&quot;,
                      mes ==10 ~ &quot;Octubre&quot;,
                      mes ==11 ~ &quot;Noviembre&quot;)) %&gt;% 
  left_join(aerolineas) %&gt;% 
  select(mes, nombre, everything(), - (aerolinea))</code></pre>
<p>Para mostrar la tabla en formato se utilizó la función <code>kable()</code> del paquete <code>kableExtra</code>. Por defecto el tipo de formato está en HTML. En los nombres de columnas se agregó <code>&lt;br&gt;</code> (salto de línea en HTML). Para agrupar filas se podría usar <code>collapse_rows()</code> según la variable <code>mes</code>.</p>
<pre class="r"><code>library(kableExtra) 
resumen %&gt;% select(-mes) %&gt;% 
kable( format = &quot;html&quot;, 
       format.args = list(decimal.mark = &#39;,&#39;, big.mark = &quot;.&quot;),
       col.names = ( c(&quot;Aerolínea&quot;,
                       rep(c(&quot;N&quot;,&quot;Min.&lt;br&gt;*(minutos)*&quot;,
                             &quot;Media&lt;br&gt;*(minutos)*&quot;,
                             &quot;Max.&lt;br&gt;*(minutos)*&quot;,
                             &quot;D.E&lt;br&gt;*(minutos)*&quot;),
                           2))), 
         digits = 1 , escape = F) %&gt;%
  kable_styling(c(&quot;striped&quot;),font_size = 11) %&gt;% 
  add_header_above(header = c(&quot; &quot;=1, 
                              &quot;Conjunto entrenamiento (N=6.973)&quot; = 5,
                              &quot;Conjunto prueba (N=1.715)&quot; = 5 ) ) %&gt;% 
  pack_rows(&quot;Septiembre&quot;, 1, 3) %&gt;% 
  pack_rows(&quot;Octubre&quot;, 4, 6) %&gt;% 
  pack_rows(&quot;Noviembre&quot;, 7,9) %&gt;% 
   footnote(general = &quot;D.E: Desviación estandar.&quot;,
            footnote_as_chunk = F)</code></pre>
<table class="table table-striped" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="border-bottom:hidden" colspan="1">
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Conjunto entrenamiento (N=6.973)
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Conjunto prueba (N=1.715)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Aerolínea
</th>
<th style="text-align:right;">
N
</th>
<th style="text-align:right;">
Min.<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
Media<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
Max.<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
D.E<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
N
</th>
<th style="text-align:right;">
Min.<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
Media<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
Max.<br><em>(minutos)</em>
</th>
<th style="text-align:right;">
D.E<br><em>(minutos)</em>
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>Septiembre</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
JetBlue Airways
</td>
<td style="text-align:right;">
623
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
50,4
</td>
<td style="text-align:right;">
396
</td>
<td style="text-align:right;">
62,0
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56,9
</td>
<td style="text-align:right;">
272
</td>
<td style="text-align:right;">
55,4
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
ExpressJet Airlines Inc. 
</td>
<td style="text-align:right;">
734
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
52,7
</td>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
61,4
</td>
<td style="text-align:right;">
189
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
43,9
</td>
<td style="text-align:right;">
321
</td>
<td style="text-align:right;">
48,6
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
United Air Lines Inc. 
</td>
<td style="text-align:right;">
571
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
49,2
</td>
<td style="text-align:right;">
405
</td>
<td style="text-align:right;">
66,4
</td>
<td style="text-align:right;">
142
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
62,7
</td>
<td style="text-align:right;">
406
</td>
<td style="text-align:right;">
84,7
</td>
</tr>
<tr grouplength="3">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>Octubre</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
JetBlue Airways
</td>
<td style="text-align:right;">
562
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
38,4
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
46,7
</td>
<td style="text-align:right;">
135
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
33,0
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
35,8
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
ExpressJet Airlines Inc. 
</td>
<td style="text-align:right;">
1.157
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
52,7
</td>
<td style="text-align:right;">
314
</td>
<td style="text-align:right;">
51,0
</td>
<td style="text-align:right;">
303
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
47,2
</td>
<td style="text-align:right;">
318
</td>
<td style="text-align:right;">
46,3
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
United Air Lines Inc. 
</td>
<td style="text-align:right;">
858
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
35,1
</td>
<td style="text-align:right;">
288
</td>
<td style="text-align:right;">
43,6
</td>
<td style="text-align:right;">
215
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
35,7
</td>
<td style="text-align:right;">
216
</td>
<td style="text-align:right;">
39,1
</td>
</tr>
<tr grouplength="3">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>Noviembre</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
JetBlue Airways
</td>
<td style="text-align:right;">
652
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
36,2
</td>
<td style="text-align:right;">
299
</td>
<td style="text-align:right;">
39,5
</td>
<td style="text-align:right;">
149
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
39,5
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
34,5
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
ExpressJet Airlines Inc. 
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
42,3
</td>
<td style="text-align:right;">
389
</td>
<td style="text-align:right;">
42,3
</td>
<td style="text-align:right;">
236
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
44,2
</td>
<td style="text-align:right;">
334
</td>
<td style="text-align:right;">
45,9
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
United Air Lines Inc. 
</td>
<td style="text-align:right;">
829
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
36,1
</td>
<td style="text-align:right;">
346
</td>
<td style="text-align:right;">
47,9
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
33,1
</td>
<td style="text-align:right;">
335
</td>
<td style="text-align:right;">
45,1
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<span style="font-style: italic;">Note: </span>
</td>
</tr>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<sup></sup> D.E: Desviación estandar.
</td>
</tr>
</tfoot>
</table>
<p>Para formato Latex se debe especificar en el argumento <code>formato = "latex"</code>. Algunos argumentos son difentes, como en el caso de los saltos en líneas en los nombres:</p>
<pre class="r"><code>resumen %&gt;% select(-mes) %&gt;% 
 kable( format.args = list(decimal.mark = &#39;,&#39;, big.mark = &quot;.&quot;),
        digits = 2, &quot;latex&quot;, booktabs= T, linesep=&quot;&quot;, 
        escape = F, 
        caption = &quot;Resumen estadístico&quot;,
        col.names = linebreak( c(&quot;Aerolínea&quot;,
                       rep(c(&quot;N&quot;,&quot;Min.\n(minutos&quot;,
                             &quot;Media\n(minutos)&quot;,
                             &quot;Max.\n(minutos)&quot;,
                             &quot;D.E\n(minutos)&quot;),
                           2)))) %&gt;%
  kable_styling(latex_options=&quot;scale_down&quot;) %&gt;% 
  add_header_above(header = c(&quot; &quot;=1, 
                              &quot;Conjunto entrenamiento (N=6.973)&quot; = 5,
                              &quot;Conjunto prueba (N=1.715)&quot; = 5 ) ) %&gt;% 
  pack_rows(&quot;Septiembre&quot;, 1, 3) %&gt;% 
  pack_rows(&quot;Octubre&quot;, 4, 6) %&gt;% 
  pack_rows(&quot;Noviembre&quot;, 7,9) %&gt;% 
   footnote(symbol = &quot;D.E: Desviación estandar.&quot;,
            footnote_as_chunk = F)</code></pre>
<p>La salida sería algo así:</p>
<div class="figure">
<img src="/post/2019-10-06-tabla-de-estadisticas.en_files/figure-html/Capture1.PNG" alt="Salida en formato latex" style="width:100.0%" />
<p class="caption">Salida en formato latex</p>
</div>
</div>
